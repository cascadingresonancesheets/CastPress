const payments=document.querySelectorAll(".billing-radio"),billingForms=document.querySelectorAll(".billing-radio__form"),billingFormsItems=document.querySelectorAll(".billing-radio__form input"),cSelects=(0<payments.length&&(payments.forEach(e=>{var t=e.querySelector(".custom-radio__input");let r=e.querySelector(".billing-radio__form"),s=e.querySelectorAll("input");t.onclick=function(){billingForms.forEach(e=>{e.style.display="none"}),r.style.display="flex",billingFormsItems.forEach(e=>{e.removeAttribute("form")}),s.forEach(e=>{e.setAttribute("form","billing-form")})}}),payments[0].querySelector(".custom-radio__input").click()),document.querySelectorAll(".custom-select")),humb=(cSelects.forEach(e=>{let r=e.querySelector("select").querySelectorAll("option"),t=document.createElement("DIV"),s=(t.setAttribute("class","custom-select__selected"),e.appendChild(t),e.querySelector(".custom-select__selected"));var a=document.createElement("DIV");a.setAttribute("class","custom-select__items"),e.appendChild(a);let o=e.querySelector(".custom-select__items"),l=0,c=(r.forEach(e=>{var t=document.createElement("DIV");t.setAttribute("class","custom-select__item"),t.setAttribute("data-index",l++),t.innerHTML=e.innerHTML,o.appendChild(t)}),o.querySelectorAll(".custom-select__item")),n=0;r.forEach(e=>{1==e.selected&&(c[n].classList.add("custom-select__item_is-selected"),t.innerHTML=r[n].innerHTML),n++}),s.addEventListener("click",function(){cSelects.forEach(e=>{e.querySelector(".custom-select__selected")!==this&&(e.querySelector(".custom-select__selected").classList.remove("custom-select__selected_is-open"),e.querySelector(".custom-select__items").classList.remove("custom-select__items_is-open"))}),this.classList.toggle("custom-select__selected_is-open"),this.nextElementSibling.classList.toggle("custom-select__items_is-open")}),o.addEventListener("click",function(e){var t;e.target.classList.contains("custom-select__item")&&(t=e.target.innerHTML,s.innerHTML=t,t=e.target.dataset.index,r[t].selected="selected",c.forEach(e=>{e.classList.remove("custom-select__item_is-selected")}),e.target.classList.add("custom-select__item_is-selected"),e.target.parentNode.classList.remove("custom-select__items_is-open"),e.target.parentNode.previousElementSibling.classList.remove("custom-select__selected_is-open"))})}),document.addEventListener("click",e=>{e.target.closest(".custom-select")||document.querySelectorAll(".custom-select").forEach(e=>{e.querySelector(".custom-select__selected").classList.remove("custom-select__selected_is-open"),e.querySelector(".custom-select__items").classList.remove("custom-select__items_is-open")})}),document.querySelector(".humb")),topnav=document.querySelector(".topnav"),searchBtn=(humb.onclick=function(){humb.classList.toggle("humb_is-open"),topnav.classList.toggle("topnav_is-open")},document.addEventListener("click",e=>{e.target.closest(".header")||e.target.closest(".humb")||(humb.classList.remove("humb_is-open"),topnav.classList.remove("topnav_is-open"))}),document.querySelector(".search-icon")),searchCross=document.querySelector(".search-icon__cross"),searchSvg=document.querySelector(".search-icon__svg"),searchField=document.querySelector(".header-search"),subMenus=(searchBtn.onclick=function(){searchField.classList.toggle("header-search_active"),searchCross.classList.toggle("search-icon__cross_active"),searchSvg.classList.toggle("search-icon__svg_hidden")},document.addEventListener("click",e=>{e.target.closest(".header-search")||e.target.closest(".search-icon")||(searchField.classList.remove("header-search_active"),searchCross.classList.remove("search-icon__cross_active"),searchSvg.classList.remove("search-icon__svg_hidden"))}),document.querySelectorAll(".topnav__item_has-submenu")),player=(subMenus.forEach(e=>{let t=e.querySelector(".submenu-toggle"),r=e.querySelector(".topnav__submenu");t.onclick=function(){t.classList.toggle("submenu-toggle_open"),r.classList.toggle("topnav__submenu_is-open")}}),window.addEventListener("resize",()=>{subMenus.forEach(e=>{var t=e.querySelector(".submenu-toggle"),e=e.querySelector(".topnav__submenu");t.classList.remove("submenu-toggle_open"),e.classList.remove("topnav__submenu_is-open")}),humb.classList.remove("humb_is-open"),topnav.classList.remove("topnav_is-open")}),document.getElementById("player")),playerPlay=document.querySelector(".player__play"),playerPlaySVG=document.querySelector(".player__play-svg"),playerPauseSVG=document.querySelector(".player__pause-svg"),playerCurrentTime=document.querySelector(".player__current-time"),playerPlayTime=document.querySelector(".player__play-time"),playerProgressBar=document.querySelector(".player__progress-bar"),playerProgress=document.querySelector(".player__progress"),playerVolume=document.querySelector(".player__volume"),playerVolumeSVG=document.querySelector(".player__volume-svg"),playerVolumeMutedSVG=document.querySelector(".player__volume_muted-svg"),playerVolumeBar=document.querySelector(".player__volume-bar"),playerVolumeValue=document.querySelector(".player__volume-value");if(player){localStorage.volume&&(player.volume=localStorage.volume,playerVolumeValue.style.height=100*player.volume*.7+"px");let e=setInterval(()=>{},500);function timePrettier(e){var e=parseInt(e,10),t=Math.floor(e/3600),r=Math.floor((e-3600*t)/60),e=e-3600*t-60*r;return(t=t<10?"0"+t:t)+":"+(r=r<10?"0"+r:r)+":"+(e=e<10?"0"+e:e)}function getMinutes(e){e=parseInt(e,10);return Math.floor(e/60)}clearInterval(e),player.addEventListener("loadedmetadata",function(){playerPlayTime.innerHTML=timePrettier(Math.round(player.duration));var e=document.querySelector(".transcript__caption span");e&&(e.innerHTML=getMinutes(Math.round(player.duration)))}),player.addEventListener("ended",function(){playerPlaySVG.classList.add("player__play-svg_is-active"),playerPauseSVG.classList.remove("player__pause-svg_is-active")}),playerPlay.onclick=function(){player.paused?player.play():player.pause()};const K=[];let r;player.addEventListener("play",()=>{playerPlaySVG.classList.remove("player__play-svg_is-active"),playerPauseSVG.classList.add("player__pause-svg_is-active"),e=setInterval(()=>{var e=Math.round(player.currentTime),t=timePrettier(e);playerCurrentTime.innerHTML=t,playerProgress.style.width=e/(player.duration/100)+"%",K.push(e),r=[...new Set(K)],console.log(r)},500)}),player.addEventListener("pause",()=>{playerPlaySVG.classList.add("player__play-svg_is-active"),playerPauseSVG.classList.remove("player__pause-svg_is-active"),clearInterval(e)});const M=document.querySelector("#trigger");function getRelativeCoordinates(e,t){const r=e.pageX;e.pageY;var s={left:t.offsetLeft,top:t.offsetTop};let a=t.offsetParent;for(;a;)s.left+=a.offsetLeft,s.top+=a.offsetTop,a=a.offsetParent;return r-s.left}function getRelativeCoordinatesV(e){var t;return t=("player__volume-value"==e.target.classList?e.target.parentNode:e.target).getBoundingClientRect(),e.clientY-t.top}M.addEventListener("click",function(){player.dataset.url;var e=new FormData;e.append("action","cast-save-stats"),e.append("id",player.dataset.id),e.append("stat",r),e.append("time",Math.round(player.duration)),navigator.sendBeacon(player.dataset.url,e)}),window.addEventListener("unload",function(){}),playerProgressBar.addEventListener("click",e=>{playerProgress.style.width=getRelativeCoordinates(e,e.target)+"px",player.currentTime=player.duration/100*(getRelativeCoordinates(e,e.target)/(playerProgressBar.offsetWidth/100));e=Math.round(player.currentTime);playerCurrentTime.innerHTML=timePrettier(e)}),playerVolume.onclick=function(){playerVolumeSVG.classList.toggle("player__volume-svg_is-active"),playerVolumeMutedSVG.classList.toggle("player__volume_muted-svg_is-active"),player.muted?player.muted=!1:player.muted=!0},playerVolumeBar.addEventListener("click",e=>{playerVolumeValue.style.height=70-getRelativeCoordinatesV(e,playerVolumeBar)+"px",player.volume=1-playerVolumeValue.offsetTop/(playerVolumeBar.offsetTop/100)/-100,localStorage.setItem("volume",player.volume),console.log(player.volume)})}Share={vkontakte:function(e,t,r,s){url="http://vkontakte.ru/share.php?",url=(url=(url=(url+="url="+encodeURIComponent(e))+"&title="+encodeURIComponent(t))+"&description="+encodeURIComponent(s))+"&image="+encodeURIComponent(r)+"&noparse=true",Share.popup(url)},facebook:function(e,t,r,s){url="http://www.facebook.com/sharer.php?s=100",url=(url=(url=(url+="&p[title]="+encodeURIComponent(t))+"&p[summary]="+encodeURIComponent(s))+"&p[url]="+encodeURIComponent(e))+"&p[images][0]="+encodeURIComponent(r),Share.popup(url)},twitter:function(e,t){url="http://twitter.com/share?",url=(url=(url+="text="+encodeURIComponent(t))+"&url="+encodeURIComponent(e))+"&counturl="+encodeURIComponent(e),Share.popup(url)},popup:function(e){window.open(e,"","toolbar=0,status=0,width=626,height=436")}};const productBtns=Array.from(document.querySelectorAll(".product-tabs__btn")),productTabs=Array.from(document.querySelectorAll(".product-descr__item")),productReview=document.querySelector(".rating__link");function reviewClick(e,t){e.map(e=>{e.classList.remove("product-descr__item_active"),"review"===e.id&&e.classList.add("product-descr__item_active")}),t.map(e=>{e.classList.remove("product-tabs__btn_active"),"review"===e.dataset.tab&&e.classList.add("product-tabs__btn_active")})}productReview&&productReview.addEventListener("click",function(){reviewClick(productTabs,productBtns)}),productBtns.map(t=>{t.addEventListener("click",function(){productTabs.map(e=>{e.classList.remove("product-descr__item_active"),t.dataset.tab===e.id&&e.classList.add("product-descr__item_active")}),productBtns.map(e=>{e.classList.remove("product-tabs__btn_active"),this.classList.add("product-tabs__btn_active")})})});const accBtns=Array.from(document.querySelectorAll(".account-tabs__btn")),accTabs=Array.from(document.querySelectorAll(".account-item"));accBtns.map(t=>{t.addEventListener("click",function(){accTabs.map(e=>{e.classList.add("account-item_hidden"),t.dataset.tab===e.id&&e.classList.remove("account-item_hidden")}),accBtns.map(e=>{e.classList.remove("account-tabs__btn_active"),this.classList.add("account-tabs__btn_active")})})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJpbGxpbmcuanMiLCJjdXN0b20tc2VsZWN0LmpzIiwibWVudS5qcyIsInBsYXllci5qcyIsInNoYXJlLmpzIiwidGFicy5qcyJdLCJuYW1lcyI6WyJwYXltZW50cyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImJpbGxpbmdGb3JtcyIsImJpbGxpbmdGb3Jtc0l0ZW1zIiwiY1NlbGVjdHMiLCJsZW5ndGgiLCJmb3JFYWNoIiwibGV0IiwicmFkaW8iLCJlbCIsInF1ZXJ5U2VsZWN0b3IiLCJmb3JtIiwiaW5wdXRzIiwib25jbGljayIsInN0eWxlIiwiZGlzcGxheSIsInJlbW92ZUF0dHJpYnV0ZSIsInNldEF0dHJpYnV0ZSIsImNsaWNrIiwiaHVtYiIsIm9wdGlvbnMiLCJjU2VsZWN0IiwiYSIsImNyZWF0ZUVsZW1lbnQiLCJuZXdTZWxlY3QiLCJhcHBlbmRDaGlsZCIsImIiLCJuZXdPcHRpb25zV3JhcCIsImkiLCJuZXdPcHRpb25zIiwiaW5uZXJIVE1MIiwib3B0aW9uIiwiaiIsInNlbGVjdGVkIiwiY2xhc3NMaXN0IiwiYWRkIiwiYWRkRXZlbnRMaXN0ZW5lciIsInRoaXMiLCJyZW1vdmUiLCJ0b2dnbGUiLCJuZXh0RWxlbWVudFNpYmxpbmciLCJlIiwiaW5kZXgiLCJ0YXJnZXQiLCJjb250YWlucyIsInZhbHVlIiwiZGF0YXNldCIsIm5ld09wdGlvbiIsInBhcmVudE5vZGUiLCJwcmV2aW91c0VsZW1lbnRTaWJsaW5nIiwiY2xvc2VzdCIsInRvcG5hdiIsInNlYXJjaEJ0biIsInNlYXJjaENyb3NzIiwic2VhcmNoU3ZnIiwic2VhcmNoRmllbGQiLCJzdWJNZW51cyIsInBsYXllciIsInN1Yk1lbnVCdG4iLCJzdWJNZW51IiwibWVudSIsIndpbmRvdyIsImdldEVsZW1lbnRCeUlkIiwicGxheWVyUGxheSIsInBsYXllclBsYXlTVkciLCJwbGF5ZXJQYXVzZVNWRyIsInBsYXllckN1cnJlbnRUaW1lIiwicGxheWVyUGxheVRpbWUiLCJwbGF5ZXJQcm9ncmVzc0JhciIsInBsYXllclByb2dyZXNzIiwicGxheWVyVm9sdW1lIiwicGxheWVyVm9sdW1lU1ZHIiwicGxheWVyVm9sdW1lTXV0ZWRTVkciLCJwbGF5ZXJWb2x1bWVCYXIiLCJwbGF5ZXJWb2x1bWVWYWx1ZSIsImxvY2FsU3RvcmFnZSIsInZvbHVtZSIsImhlaWdodCIsImN1cnJlbnRUaW1lIiwic2V0SW50ZXJ2YWwiLCJ0aW1lUHJldHRpZXIiLCJ0aW1lIiwic2VjX251bSIsInBhcnNlSW50IiwiaG91cnMiLCJNYXRoIiwiZmxvb3IiLCJtaW51dGVzIiwic2Vjb25kcyIsImdldE1pbnV0ZXMiLCJjbGVhckludGVydmFsIiwicm91bmQiLCJkdXJhdGlvbiIsIm1pbnNJbmZvIiwicGF1c2VkIiwicGxheSIsInBhdXNlIiwicGxheWVkU2Vjb25kcyIsInVuaXF1ZVBsYXllZFNlY29uZHMiLCJwcmV0dHlUaW1lIiwid2lkdGgiLCJwdXNoIiwiU2V0IiwiY29uc29sZSIsImxvZyIsInNlbmRUcmlnZ2VyIiwiZ2V0UmVsYXRpdmVDb29yZGluYXRlcyIsImV2ZW50IiwicmVmZXJlbmNlRWxlbWVudCIsInBvc2l0aW9uIiwicGFnZVgiLCJwYWdlWSIsIm9mZnNldCIsImxlZnQiLCJvZmZzZXRMZWZ0IiwidG9wIiwib2Zmc2V0VG9wIiwicmVmZXJlbmNlIiwib2Zmc2V0UGFyZW50IiwiZ2V0UmVsYXRpdmVDb29yZGluYXRlc1YiLCJyZWN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwiY2xpZW50WSIsInVybCIsImRhdGEiLCJGb3JtRGF0YSIsImFwcGVuZCIsImlkIiwibmF2aWdhdG9yIiwic2VuZEJlYWNvbiIsIm9mZnNldFdpZHRoIiwibXV0ZWQiLCJzZXRJdGVtIiwiU2hhcmUiLCJ2a29udGFrdGUiLCJwdXJsIiwicHRpdGxlIiwicGltZyIsInRleHQiLCJlbmNvZGVVUklDb21wb25lbnQiLCJwb3B1cCIsImZhY2Vib29rIiwidHdpdHRlciIsIm9wZW4iLCJwcm9kdWN0QnRucyIsIkFycmF5IiwiZnJvbSIsInByb2R1Y3RUYWJzIiwicHJvZHVjdFJldmlldyIsInJldmlld0NsaWNrIiwibWFwIiwidGFiIiwiYnRuIiwiYWNjQnRucyIsImFjY1RhYnMiXSwibWFwcGluZ3MiOiJBQUFBLE1BQUFBLFNBQUFDLFNBQUFDLGlCQUFBLGdCQUFBLEVBQ0FDLGFBQUFGLFNBQUFDLGlCQUFBLHNCQUFBLEVBQ0FFLGtCQUFBSCxTQUFBQyxpQkFBQSw0QkFBQSxFQ0ZBRyxVRElBLEVBQUFMLFNBQUFNLFNBQ0FOLFNBQUFPLFFBQUEsSUFDQUMsSUFBQUMsRUFBQUMsRUFBQUMsY0FBQSxzQkFBQSxFQUNBSCxJQUFBSSxFQUFBRixFQUFBQyxjQUFBLHNCQUFBLEVBQ0FFLEVBQUFILEVBQUFSLGlCQUFBLE9BQUEsRUFFQU8sRUFBQUssUUFBQSxXQUNBWCxhQUFBSSxRQUFBLElBQ0FHLEVBQUFLLE1BQUFDLFFBQUEsTUFDQSxDQUFBLEVBQ0FKLEVBQUFHLE1BQUFDLFFBQUEsT0FFQVosa0JBQUFHLFFBQUEsSUFDQUcsRUFBQU8sZ0JBQUEsTUFBQSxDQUNBLENBQUEsRUFFQUosRUFBQU4sUUFBQSxJQUNBRyxFQUFBUSxhQUFBLE9BQUEsY0FBQSxDQUNBLENBQUEsQ0FDQSxDQUNBLENBQUEsRUFFQWxCLFNBQUEsR0FBQVcsY0FBQSxzQkFBQSxFQUFBUSxNQUFBLEdDMUJBbEIsU0FBQUMsaUJBQUEsZ0JBQUEsR0NDQWtCLE1EQ0FmLFNBQUFFLFFBQUEsSUFFQUMsSUFBQWEsRUFEQUMsRUFBQVgsY0FBQSxRQUFBLEVBQ0FULGlCQUFBLFFBQUEsRUFFQXFCLEVBQUF0QixTQUFBdUIsY0FBQSxLQUFBLEVBR0FDLEdBRkFGLEVBQUFMLGFBQUEsUUFBQSx5QkFBQSxFQUNBSSxFQUFBSSxZQUFBSCxDQUFBLEVBQ0FELEVBQUFYLGNBQUEsMEJBQUEsR0FFQUgsSUFBQW1CLEVBQUExQixTQUFBdUIsY0FBQSxLQUFBLEVBQ0FHLEVBQUFULGFBQUEsUUFBQSxzQkFBQSxFQUNBSSxFQUFBSSxZQUFBQyxDQUFBLEVBQ0FuQixJQUFB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QUEsRUFDQUQsS0FBQUgsVUFBQUMsSUFBQSwwQkFBQSxDQUNBLENBQUEsQ0FDQSxDQUFBLENBQ0EsQ0FBQSIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcGF5bWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmJpbGxpbmctcmFkaW9cIik7XHJcbmNvbnN0IGJpbGxpbmdGb3JtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYmlsbGluZy1yYWRpb19fZm9ybVwiKTtcclxuY29uc3QgYmlsbGluZ0Zvcm1zSXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmJpbGxpbmctcmFkaW9fX2Zvcm0gaW5wdXRcIik7XHJcblxyXG5pZiAocGF5bWVudHMubGVuZ3RoID4gMCkge1xyXG4gIHBheW1lbnRzLmZvckVhY2goKGVsKSA9PiB7XHJcbiAgICBsZXQgcmFkaW8gPSBlbC5xdWVyeVNlbGVjdG9yKFwiLmN1c3RvbS1yYWRpb19faW5wdXRcIik7XHJcbiAgICBsZXQgZm9ybSA9IGVsLnF1ZXJ5U2VsZWN0b3IoXCIuYmlsbGluZy1yYWRpb19fZm9ybVwiKTtcclxuICAgIGxldCBpbnB1dHMgPSBlbC5xdWVyeVNlbGVjdG9yQWxsKFwiaW5wdXRcIik7XHJcblxyXG4gICAgcmFkaW8ub25jbGljayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgYmlsbGluZ0Zvcm1zLmZvckVhY2goKGVsKSA9PiB7XHJcbiAgICAgICAgZWwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICB9KTtcclxuICAgICAgZm9ybS5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XHJcblxyXG4gICAgICBiaWxsaW5nRm9ybXNJdGVtcy5mb3JFYWNoKChlbCkgPT4ge1xyXG4gICAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZShcImZvcm1cIik7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaW5wdXRzLmZvckVhY2goKGVsKSA9PiB7XHJcbiAgICAgICAgZWwuc2V0QXR0cmlidXRlKFwiZm9ybVwiLCBcImJpbGxpbmctZm9ybVwiKTtcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG4gIH0pO1xyXG5cclxuICBwYXltZW50c1swXS5xdWVyeVNlbGVjdG9yKFwiLmN1c3RvbS1yYWRpb19faW5wdXRcIikuY2xpY2soKTtcclxufVxyXG4iLCJjb25zdCBjU2VsZWN0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuY3VzdG9tLXNlbGVjdFwiKTtcclxuXHJcbmNTZWxlY3RzLmZvckVhY2goKGNTZWxlY3QpID0+IHtcclxuICBsZXQgc2VsZWN0ID0gY1NlbGVjdC5xdWVyeVNlbGVjdG9yKFwic2VsZWN0XCIpO1xyXG4gIGxldCBvcHRpb25zID0gc2VsZWN0LnF1ZXJ5U2VsZWN0b3JBbGwoXCJvcHRpb25cIik7XHJcblxyXG4gIGxldCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIkRJVlwiKTtcclxuICBhLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwiY3VzdG9tLXNlbGVjdF9fc2VsZWN0ZWRcIik7XHJcbiAgY1NlbGVjdC5hcHBlbmRDaGlsZChhKTtcclxuICBsZXQgbmV3U2VsZWN0ID0gY1NlbGVjdC5xdWVyeVNlbGVjdG9yKFwiLmN1c3RvbS1zZWxlY3RfX3NlbGVjdGVkXCIpO1xyXG5cclxuICBsZXQgYiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJESVZcIik7XHJcbiAgYi5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcImN1c3RvbS1zZWxlY3RfX2l0ZW1zXCIpO1xyXG4gIGNTZWxlY3QuYXBwZW5kQ2hpbGQoYik7XHJcbiAgbGV0IG5ld09wdGlvbnNXcmFwID0gY1NlbGVjdC5xdWVyeVNlbGVjdG9yKFwiLmN1c3RvbS1zZWxlY3RfX2l0ZW1zXCIpO1xyXG5cclxuICBsZXQgaSA9IDA7XHJcbiAgb3B0aW9ucy5mb3JFYWNoKChvcHRpb24pID0+IHtcclxuICAgIGxldCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIkRJVlwiKTtcclxuICAgIGEuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJjdXN0b20tc2VsZWN0X19pdGVtXCIpO1xyXG4gICAgYS5zZXRBdHRyaWJ1dGUoXCJkYXRhLWluZGV4XCIsIGkrKyk7XHJcbiAgICBhLmlubmVySFRNTCA9IG9wdGlvbi5pbm5lckhUTUw7XHJcbiAgICBuZXdPcHRpb25zV3JhcC5hcHBlbmRDaGlsZChhKTtcclxuICB9KTtcclxuXHJcbiAgbGV0IG5ld09wdGlvbnMgPSBuZXdPcHRpb25zV3JhcC5xdWVyeVNlbGVjdG9yQWxsKFwiLmN1c3RvbS1zZWxlY3RfX2l0ZW1cIik7XHJcblxyXG4gIGxldCBqID0gMDtcclxuICBvcHRpb25zLmZvckVhY2goKG9wdGlvbikgPT4ge1xyXG4gICAgaWYgKG9wdGlvbi5zZWxlY3RlZCA9PSB0cnVlKSB7XHJcbiAgICAgIG5ld09wdGlvbnNbal0uY2xhc3NMaXN0LmFkZChcImN1c3RvbS1zZWxlY3RfX2l0ZW1faXMtc2VsZWN0ZWRcIik7XHJcbiAgICAgIGEuaW5uZXJIVE1MID0gb3B0aW9uc1tqXS5pbm5lckhUTUw7XHJcbiAgICB9XHJcbiAgICBqKys7XHJcbiAgfSk7XHJcblxyXG4gIG5ld1NlbGVjdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgY1NlbGVjdHMuZm9yRWFjaCgoZWwpID0+IHtcclxuICAgICAgaWYgKGVsLnF1ZXJ5U2VsZWN0b3IoXCIuY3VzdG9tLXNlbGVjdF9fc2VsZWN0ZWRcIikgIT09IHRoaXMpIHtcclxuICAgICAgICBlbC5xdWVyeVNlbGVjdG9yKFwiLmN1c3RvbS1zZWxlY3RfX3NlbGVjdGVkXCIpLmNsYXNzTGlzdC5yZW1vdmUoXCJjdXN0b20tc2VsZWN0X19zZWxlY3RlZF9pcy1vcGVuXCIpO1xyXG4gICAgICAgIGVsLnF1ZXJ5U2VsZWN0b3IoXCIuY3VzdG9tLXNlbGVjdF9faXRlbXNcIikuY2xhc3NMaXN0LnJlbW92ZShcImN1c3RvbS1zZWxlY3RfX2l0ZW1zX2lzLW9wZW5cIik7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuY2xhc3NMaXN0LnRvZ2dsZShcImN1c3RvbS1zZWxlY3RfX3NlbGVjdGVkX2lzLW9wZW5cIik7XHJcbiAgICB0aGlzLm5leHRFbGVtZW50U2libGluZy5jbGFzc0xpc3QudG9nZ2xlKFwiY3VzdG9tLXNlbGVjdF9faXRlbXNfaXMtb3BlblwiKTtcclxuICB9KTtcclxuXHJcbiAgbmV3T3B0aW9uc1dyYXAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiY3VzdG9tLXNlbGVjdF9faXRlbVwiKSkge1xyXG4gICAgICBsZXQgdmFsdWUgPSBlLnRhcmdldC5pbm5lckhUTUw7XHJcbiAgICAgIG5ld1NlbGVjdC5pbm5lckhUTUwgPSB2YWx1ZTtcclxuICAgICAgbGV0IGluZGV4ID0gZS50YXJnZXQuZGF0YXNldC5pbmRleDtcclxuICAgICAgb3B0aW9uc1tpbmRleF0uc2VsZWN0ZWQgPSBcInNlbGVjdGVkXCI7XHJcblxyXG4gICAgICBuZXdPcHRpb25zLmZvckVhY2goKG5ld09wdGlvbikgPT4ge1xyXG4gICAgICAgIG5ld09wdGlvbi5jbGFzc0xpc3QucmVtb3ZlKFwiY3VzdG9tLXNlbGVjdF9faXRlbV9pcy1zZWxlY3RlZFwiKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBlLnRhcmdldC5jbGFzc0xpc3QuYWRkKFwiY3VzdG9tLXNlbGVjdF9faXRlbV9pcy1zZWxlY3RlZFwiKTtcclxuICAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKFwiY3VzdG9tLXNlbGVjdF9faXRlbXNfaXMtb3BlblwiKTtcclxuICAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5wcmV2aW91c0VsZW1lbnRTaWJsaW5nLmNsYXNzTGlzdC5yZW1vdmUoXCJjdXN0b20tc2VsZWN0X19zZWxlY3RlZF9pcy1vcGVuXCIpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59KTtcclxuXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xyXG4gIGlmICghZS50YXJnZXQuY2xvc2VzdChcIi5jdXN0b20tc2VsZWN0XCIpKSB7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmN1c3RvbS1zZWxlY3RcIikuZm9yRWFjaCgoZWwpID0+IHtcclxuICAgICAgZWwucXVlcnlTZWxlY3RvcihcIi5jdXN0b20tc2VsZWN0X19zZWxlY3RlZFwiKS5jbGFzc0xpc3QucmVtb3ZlKFwiY3VzdG9tLXNlbGVjdF9fc2VsZWN0ZWRfaXMtb3BlblwiKTtcclxuICAgICAgZWwucXVlcnlTZWxlY3RvcihcIi5jdXN0b20tc2VsZWN0X19pdGVtc1wiKS5jbGFzc0xpc3QucmVtb3ZlKFwiY3VzdG9tLXNlbGVjdF9faXRlbXNfaXMtb3BlblwiKTtcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcbiIsIi8vIEh1bWJ1cmdlclxyXG5jb25zdCBodW1iID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5odW1iXCIpO1xyXG5jb25zdCB0b3BuYXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnRvcG5hdlwiKTtcclxuaHVtYi5vbmNsaWNrID0gZnVuY3Rpb24gKCkge1xyXG4gIGh1bWIuY2xhc3NMaXN0LnRvZ2dsZShcImh1bWJfaXMtb3BlblwiKTtcclxuICB0b3BuYXYuY2xhc3NMaXN0LnRvZ2dsZShcInRvcG5hdl9pcy1vcGVuXCIpO1xyXG59O1xyXG5cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XHJcbiAgaWYgKCFlLnRhcmdldC5jbG9zZXN0KFwiLmhlYWRlclwiKSAmJiAhZS50YXJnZXQuY2xvc2VzdChcIi5odW1iXCIpKSB7XHJcbiAgICBodW1iLmNsYXNzTGlzdC5yZW1vdmUoXCJodW1iX2lzLW9wZW5cIik7XHJcbiAgICB0b3BuYXYuY2xhc3NMaXN0LnJlbW92ZShcInRvcG5hdl9pcy1vcGVuXCIpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBTZWFyY2hcclxuY29uc3Qgc2VhcmNoQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zZWFyY2gtaWNvblwiKTtcclxuY29uc3Qgc2VhcmNoQ3Jvc3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNlYXJjaC1pY29uX19jcm9zc1wiKTtcclxuY29uc3Qgc2VhcmNoU3ZnID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zZWFyY2gtaWNvbl9fc3ZnXCIpO1xyXG5jb25zdCBzZWFyY2hGaWVsZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuaGVhZGVyLXNlYXJjaFwiKTtcclxuXHJcbnNlYXJjaEJ0bi5vbmNsaWNrID0gZnVuY3Rpb24gKCkge1xyXG4gIHNlYXJjaEZpZWxkLmNsYXNzTGlzdC50b2dnbGUoXCJoZWFkZXItc2VhcmNoX2FjdGl2ZVwiKTtcclxuICBzZWFyY2hDcm9zcy5jbGFzc0xpc3QudG9nZ2xlKFwic2VhcmNoLWljb25fX2Nyb3NzX2FjdGl2ZVwiKTtcclxuICBzZWFyY2hTdmcuY2xhc3NMaXN0LnRvZ2dsZShcInNlYXJjaC1pY29uX19zdmdfaGlkZGVuXCIpO1xyXG59O1xyXG5cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XHJcbiAgaWYgKCFlLnRhcmdldC5jbG9zZXN0KFwiLmhlYWRlci1zZWFyY2hcIikgJiYgIWUudGFyZ2V0LmNsb3Nlc3QoXCIuc2VhcmNoLWljb25cIikpIHtcclxuICAgIHNlYXJjaEZpZWxkLmNsYXNzTGlzdC5yZW1vdmUoXCJoZWFkZXItc2VhcmNoX2FjdGl2ZVwiKTtcclxuICAgIHNlYXJjaENyb3NzLmNsYXNzTGlzdC5yZW1vdmUoXCJzZWFyY2gtaWNvbl9fY3Jvc3NfYWN0aXZlXCIpO1xyXG4gICAgc2VhcmNoU3ZnLmNsYXNzTGlzdC5yZW1vdmUoXCJzZWFyY2gtaWNvbl9fc3ZnX2hpZGRlblwiKTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8gU3VibWVudVxyXG5jb25zdCBzdWJNZW51cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudG9wbmF2X19pdGVtX2hhcy1zdWJtZW51XCIpO1xyXG5zdWJNZW51cy5mb3JFYWNoKChzdWJNZW51KSA9PiB7XHJcbiAgbGV0IHN1Yk1lbnVCdG4gPSBzdWJNZW51LnF1ZXJ5U2VsZWN0b3IoXCIuc3VibWVudS10b2dnbGVcIik7XHJcbiAgbGV0IG1lbnUgPSBzdWJNZW51LnF1ZXJ5U2VsZWN0b3IoXCIudG9wbmF2X19zdWJtZW51XCIpO1xyXG4gIHN1Yk1lbnVCdG4ub25jbGljayA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHN1Yk1lbnVCdG4uY2xhc3NMaXN0LnRvZ2dsZShcInN1Ym1lbnUtdG9nZ2xlX29wZW5cIik7XHJcbiAgICBtZW51LmNsYXNzTGlzdC50b2dnbGUoXCJ0b3BuYXZfX3N1Ym1lbnVfaXMtb3BlblwiKTtcclxuICB9O1xyXG59KTtcclxuXHJcbi8vIENsb3NlIGFsbCBvbiByZXNpemVcclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgKCkgPT4ge1xyXG4gIHN1Yk1lbnVzLmZvckVhY2goKHN1Yk1lbnUpID0+IHtcclxuICAgIGxldCBzdWJNZW51QnRuID0gc3ViTWVudS5xdWVyeVNlbGVjdG9yKFwiLnN1Ym1lbnUtdG9nZ2xlXCIpO1xyXG4gICAgbGV0IG1lbnUgPSBzdWJNZW51LnF1ZXJ5U2VsZWN0b3IoXCIudG9wbmF2X19zdWJtZW51XCIpO1xyXG4gICAgc3ViTWVudUJ0bi5jbGFzc0xpc3QucmVtb3ZlKFwic3VibWVudS10b2dnbGVfb3BlblwiKTtcclxuICAgIG1lbnUuY2xhc3NMaXN0LnJlbW92ZShcInRvcG5hdl9fc3VibWVudV9pcy1vcGVuXCIpO1xyXG4gIH0pO1xyXG4gIGh1bWIuY2xhc3NMaXN0LnJlbW92ZShcImh1bWJfaXMtb3BlblwiKTtcclxuICB0b3BuYXYuY2xhc3NMaXN0LnJlbW92ZShcInRvcG5hdl9pcy1vcGVuXCIpO1xyXG59KTtcclxuIiwiY29uc3QgcGxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwbGF5ZXJcIik7XHJcbmNvbnN0IHBsYXllclBsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllcl9fcGxheVwiKTtcclxuY29uc3QgcGxheWVyUGxheVNWRyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyX19wbGF5LXN2Z1wiKTtcclxuY29uc3QgcGxheWVyUGF1c2VTVkcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllcl9fcGF1c2Utc3ZnXCIpO1xyXG5jb25zdCBwbGF5ZXJDdXJyZW50VGltZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyX19jdXJyZW50LXRpbWVcIik7XHJcbmNvbnN0IHBsYXllclBsYXlUaW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXJfX3BsYXktdGltZVwiKTtcclxuY29uc3QgcGxheWVyUHJvZ3Jlc3NCYXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllcl9fcHJvZ3Jlc3MtYmFyXCIpO1xyXG5jb25zdCBwbGF5ZXJQcm9ncmVzcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyX19wcm9ncmVzc1wiKTtcclxuXHJcbmNvbnN0IHBsYXllclZvbHVtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyX192b2x1bWVcIik7XHJcbmNvbnN0IHBsYXllclZvbHVtZVNWRyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyX192b2x1bWUtc3ZnXCIpO1xyXG5jb25zdCBwbGF5ZXJWb2x1bWVNdXRlZFNWRyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyX192b2x1bWVfbXV0ZWQtc3ZnXCIpO1xyXG5jb25zdCBwbGF5ZXJWb2x1bWVCYXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllcl9fdm9sdW1lLWJhclwiKTtcclxuY29uc3QgcGxheWVyVm9sdW1lVmFsdWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllcl9fdm9sdW1lLXZhbHVlXCIpO1xyXG5cclxuaWYgKHBsYXllcikge1xyXG4gIGlmIChsb2NhbFN0b3JhZ2Uudm9sdW1lKSB7XHJcbiAgICBwbGF5ZXIudm9sdW1lID0gbG9jYWxTdG9yYWdlLnZvbHVtZTtcclxuICAgIHBsYXllclZvbHVtZVZhbHVlLnN0eWxlLmhlaWdodCA9IC43ICogKHBsYXllci52b2x1bWUgKiAxMDApICsgXCJweFwiO1xyXG4gIH1cclxuXHJcbiAgbGV0IGN1cnJlbnRUaW1lID0gc2V0SW50ZXJ2YWwoKCkgPT4ge30sIDUwMCk7XHJcbiAgY2xlYXJJbnRlcnZhbChjdXJyZW50VGltZSk7XHJcblxyXG4gIHBsYXllci5hZGRFdmVudExpc3RlbmVyKFwibG9hZGVkbWV0YWRhdGFcIiwgZnVuY3Rpb24oKSB7XHJcbiAgICBwbGF5ZXJQbGF5VGltZS5pbm5lckhUTUwgPSB0aW1lUHJldHRpZXIoTWF0aC5yb3VuZChwbGF5ZXIuZHVyYXRpb24pKTtcclxuICAgIGNvbnN0IG1pbnNJbmZvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRyYW5zY3JpcHRfX2NhcHRpb24gc3BhbicpO1xyXG4gICAgaWYgKG1pbnNJbmZvKSB7XHJcbiAgICAgIG1pbnNJbmZvLmlubmVySFRNTCA9IGdldE1pbnV0ZXMoTWF0aC5yb3VuZChwbGF5ZXIuZHVyYXRpb24pKTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgcGxheWVyLmFkZEV2ZW50TGlzdGVuZXIoXCJlbmRlZFwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBwbGF5ZXJQbGF5U1ZHLmNsYXNzTGlzdC5hZGQoXCJwbGF5ZXJfX3BsYXktc3ZnX2lzLWFjdGl2ZVwiKTtcclxuICAgIHBsYXllclBhdXNlU1ZHLmNsYXNzTGlzdC5yZW1vdmUoXCJwbGF5ZXJfX3BhdXNlLXN2Z19pcy1hY3RpdmVcIik7XHJcbiAgfSk7XHJcblxyXG4gIGZ1bmN0aW9uIHRpbWVQcmV0dGllcih0aW1lKSB7XHJcbiAgICB2YXIgc2VjX251bSA9IHBhcnNlSW50KHRpbWUsIDEwKTtcclxuICAgIHZhciBob3VycyAgID0gTWF0aC5mbG9vcihzZWNfbnVtIC8gMzYwMCk7XHJcbiAgICB2YXIgbWludXRlcyA9IE1hdGguZmxvb3IoKHNlY19udW0gLSAoaG91cnMgKiAzNjAwKSkgLyA2MCk7XHJcbiAgICB2YXIgc2Vjb25kcyA9IHNlY19udW0gLSAoaG91cnMgKiAzNjAwKSAtIChtaW51dGVzICogNjApO1xyXG5cclxuICAgIGlmIChob3VycyAgIDwgMTApIHtob3VycyAgID0gXCIwXCIraG91cnM7fVxyXG4gICAgaWYgKG1pbnV0ZXMgPCAxMCkge21pbnV0ZXMgPSBcIjBcIittaW51dGVzO31cclxuICAgIGlmIChzZWNvbmRzIDwgMTApIHtzZWNvbmRzID0gXCIwXCIrc2Vjb25kczt9XHJcbiAgICByZXR1cm4gaG91cnMrJzonK21pbnV0ZXMrJzonK3NlY29uZHM7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBnZXRNaW51dGVzKHRpbWUpIHtcclxuICAgIGNvbnN0IHNlY19udW0gPSBwYXJzZUludCh0aW1lLCAxMCk7XHJcbiAgICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcigoc2VjX251bSAvIDYwKSk7XHJcblxyXG4gICAgcmV0dXJuIG1pbnV0ZXM7XHJcbiAgfVxyXG5cclxuICBwbGF5ZXJQbGF5Lm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBpZiAocGxheWVyLnBhdXNlZCkge1xyXG4gICAgICBwbGF5ZXIucGxheSgpO1xyXG5cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHBsYXllci5wYXVzZSgpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IHBsYXllZFNlY29uZHMgPSBbXTtcclxuICBsZXQgdW5pcXVlUGxheWVkU2Vjb25kcztcclxuXHJcbiAgcGxheWVyLmFkZEV2ZW50TGlzdGVuZXIoXCJwbGF5XCIsICgpID0+IHtcclxuICAgIHBsYXllclBsYXlTVkcuY2xhc3NMaXN0LnJlbW92ZShcInBsYXllcl9fcGxheS1zdmdfaXMtYWN0aXZlXCIpO1xyXG4gICAgcGxheWVyUGF1c2VTVkcuY2xhc3NMaXN0LmFkZChcInBsYXllcl9fcGF1c2Utc3ZnX2lzLWFjdGl2ZVwiKTtcclxuXHJcbiAgICBjdXJyZW50VGltZSA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgY29uc3QgdGltZSA9IE1hdGgucm91bmQocGxheWVyLmN1cnJlbnRUaW1lKTtcclxuICAgICAgY29uc3QgcHJldHR5VGltZSA9IHRpbWVQcmV0dGllcih0aW1lKTtcclxuXHJcbiAgICAgIHBsYXllckN1cnJlbnRUaW1lLmlubmVySFRNTCA9IHByZXR0eVRpbWU7XHJcbiAgICAgIHBsYXllclByb2dyZXNzLnN0eWxlLndpZHRoID0gdGltZSAvIChwbGF5ZXIuZHVyYXRpb24gLyAxMDApICsgXCIlXCI7XHJcblxyXG4gICAgICBwbGF5ZWRTZWNvbmRzLnB1c2godGltZSk7XHJcbiAgICAgIHVuaXF1ZVBsYXllZFNlY29uZHMgPSBbLi4ubmV3IFNldChwbGF5ZWRTZWNvbmRzKV07XHJcbiAgICAgIGNvbnNvbGUubG9nKHVuaXF1ZVBsYXllZFNlY29uZHMpO1xyXG5cclxuICAgIH0sIDUwMCk7XHJcbiAgfSk7XHJcblxyXG4gIHBsYXllci5hZGRFdmVudExpc3RlbmVyKFwicGF1c2VcIiwgKCkgPT4ge1xyXG4gICAgcGxheWVyUGxheVNWRy5jbGFzc0xpc3QuYWRkKFwicGxheWVyX19wbGF5LXN2Z19pcy1hY3RpdmVcIik7XHJcbiAgICBwbGF5ZXJQYXVzZVNWRy5jbGFzc0xpc3QucmVtb3ZlKFwicGxheWVyX19wYXVzZS1zdmdfaXMtYWN0aXZlXCIpO1xyXG5cclxuICAgIGNsZWFySW50ZXJ2YWwoY3VycmVudFRpbWUpO1xyXG4gIH0pO1xyXG5cclxuICBjb25zdCBzZW5kVHJpZ2dlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0cmlnZ2VyJyk7XHJcblxyXG4gIHNlbmRUcmlnZ2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XHJcbiAgICBwbGF5ZXIuZGF0YXNldC51cmxcclxuICAgIGNvbnN0IGRhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgIGRhdGEuYXBwZW5kKCdhY3Rpb24nLCAnY2FzdC1zYXZlLXN0YXRzJyk7XHJcbiAgICBkYXRhLmFwcGVuZCgnaWQnLCBwbGF5ZXIuZGF0YXNldC5pZCk7XHJcbiAgICBkYXRhLmFwcGVuZCgnc3RhdCcsIHVuaXF1ZVBsYXllZFNlY29uZHMpO1xyXG4gICAgZGF0YS5hcHBlbmQoJ3RpbWUnLCBNYXRoLnJvdW5kKHBsYXllci5kdXJhdGlvbikpO1xyXG4gICAgbmF2aWdhdG9yLnNlbmRCZWFjb24ocGxheWVyLmRhdGFzZXQudXJsLCBkYXRhKTtcclxuICB9KTtcclxuICBcclxuICAvLyBTRU5EIFNUQVRJU1RJQ1NcclxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInVubG9hZFwiLCBmdW5jdGlvbigpIHtcclxuICB9KTtcclxuXHJcbiAgcGxheWVyUHJvZ3Jlc3NCYXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XHJcbiAgICBwbGF5ZXJQcm9ncmVzcy5zdHlsZS53aWR0aCA9IGdldFJlbGF0aXZlQ29vcmRpbmF0ZXMoZSwgZS50YXJnZXQpICsgXCJweFwiO1xyXG4gICAgcGxheWVyLmN1cnJlbnRUaW1lID1cclxuICAgICAgKHBsYXllci5kdXJhdGlvbiAvIDEwMCkgKlxyXG4gICAgICAoZ2V0UmVsYXRpdmVDb29yZGluYXRlcyhlLCBlLnRhcmdldCkgL1xyXG4gICAgICAgIChwbGF5ZXJQcm9ncmVzc0Jhci5vZmZzZXRXaWR0aCAvIDEwMCkpO1xyXG4gICAgbGV0IHRpbWUgPSBNYXRoLnJvdW5kKHBsYXllci5jdXJyZW50VGltZSk7XHJcbiAgICBwbGF5ZXJDdXJyZW50VGltZS5pbm5lckhUTUwgPSB0aW1lUHJldHRpZXIodGltZSk7XHJcbiAgfSk7XHJcblxyXG4gIGZ1bmN0aW9uIGdldFJlbGF0aXZlQ29vcmRpbmF0ZXMoZXZlbnQsIHJlZmVyZW5jZUVsZW1lbnQpIHtcclxuICAgIGNvbnN0IHBvc2l0aW9uID0ge1xyXG4gICAgICB4OiBldmVudC5wYWdlWCxcclxuICAgICAgeTogZXZlbnQucGFnZVksXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IG9mZnNldCA9IHtcclxuICAgICAgbGVmdDogcmVmZXJlbmNlRWxlbWVudC5vZmZzZXRMZWZ0LFxyXG4gICAgICB0b3A6IHJlZmVyZW5jZUVsZW1lbnQub2Zmc2V0VG9wLFxyXG4gICAgfTtcclxuXHJcbiAgICBsZXQgcmVmZXJlbmNlID0gcmVmZXJlbmNlRWxlbWVudC5vZmZzZXRQYXJlbnQ7XHJcblxyXG4gICAgd2hpbGUgKHJlZmVyZW5jZSkge1xyXG4gICAgICBvZmZzZXQubGVmdCArPSByZWZlcmVuY2Uub2Zmc2V0TGVmdDtcclxuICAgICAgb2Zmc2V0LnRvcCArPSByZWZlcmVuY2Uub2Zmc2V0VG9wO1xyXG4gICAgICByZWZlcmVuY2UgPSByZWZlcmVuY2Uub2Zmc2V0UGFyZW50O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBwb3NpdGlvbi54IC0gb2Zmc2V0LmxlZnQ7XHJcbiAgfVxyXG5cclxuICBwbGF5ZXJWb2x1bWUub25jbGljayA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHBsYXllclZvbHVtZVNWRy5jbGFzc0xpc3QudG9nZ2xlKFwicGxheWVyX192b2x1bWUtc3ZnX2lzLWFjdGl2ZVwiKTtcclxuICAgIHBsYXllclZvbHVtZU11dGVkU1ZHLmNsYXNzTGlzdC50b2dnbGUoXCJwbGF5ZXJfX3ZvbHVtZV9tdXRlZC1zdmdfaXMtYWN0aXZlXCIpO1xyXG4gICAgaWYgKCFwbGF5ZXIubXV0ZWQpIHtcclxuICAgICAgcGxheWVyLm11dGVkID0gdHJ1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHBsYXllci5tdXRlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHBsYXllclZvbHVtZUJhci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcclxuICAgIHBsYXllclZvbHVtZVZhbHVlLnN0eWxlLmhlaWdodCA9IDcwIC0gZ2V0UmVsYXRpdmVDb29yZGluYXRlc1YoZSwgcGxheWVyVm9sdW1lQmFyKSArIFwicHhcIjtcclxuICAgIHBsYXllci52b2x1bWUgPSAxIC0gcGxheWVyVm9sdW1lVmFsdWUub2Zmc2V0VG9wIC8gKHBsYXllclZvbHVtZUJhci5vZmZzZXRUb3AgLyAxMDApIC8gLTEwMDtcclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd2b2x1bWUnLCBwbGF5ZXIudm9sdW1lKTtcclxuICAgIGNvbnNvbGUubG9nKHBsYXllci52b2x1bWUpO1xyXG4gIH0pO1xyXG5cclxuICBmdW5jdGlvbiBnZXRSZWxhdGl2ZUNvb3JkaW5hdGVzVihldmVudCkge1xyXG4gICAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QgPT0gJ3BsYXllcl9fdm9sdW1lLXZhbHVlJykge1xyXG4gICAgICBsZXQgcmVjdCA9IGV2ZW50LnRhcmdldC5wYXJlbnROb2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICBsZXQgeSA9IGV2ZW50LmNsaWVudFkgLSByZWN0LnRvcDtcclxuICAgICAgcmV0dXJuIHk7XHJcbiAgICB9XHJcbiAgICBsZXQgcmVjdCA9IGV2ZW50LnRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgIGxldCB5ID0gZXZlbnQuY2xpZW50WSAtIHJlY3QudG9wO1xyXG4gICAgcmV0dXJuIHk7XHJcbiAgfVxyXG59XHJcbiIsIlNoYXJlID0ge1xyXG4gIHZrb250YWt0ZTogZnVuY3Rpb24gKHB1cmwsIHB0aXRsZSwgcGltZywgdGV4dCkge1xyXG4gICAgdXJsID0gXCJodHRwOi8vdmtvbnRha3RlLnJ1L3NoYXJlLnBocD9cIjtcclxuICAgIHVybCArPSBcInVybD1cIiArIGVuY29kZVVSSUNvbXBvbmVudChwdXJsKTtcclxuICAgIHVybCArPSBcIiZ0aXRsZT1cIiArIGVuY29kZVVSSUNvbXBvbmVudChwdGl0bGUpO1xyXG4gICAgdXJsICs9IFwiJmRlc2NyaXB0aW9uPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KHRleHQpO1xyXG4gICAgdXJsICs9IFwiJmltYWdlPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KHBpbWcpO1xyXG4gICAgdXJsICs9IFwiJm5vcGFyc2U9dHJ1ZVwiO1xyXG4gICAgU2hhcmUucG9wdXAodXJsKTtcclxuICB9LFxyXG4gIGZhY2Vib29rOiBmdW5jdGlvbiAocHVybCwgcHRpdGxlLCBwaW1nLCB0ZXh0KSB7XHJcbiAgICB1cmwgPSBcImh0dHA6Ly93d3cuZmFjZWJvb2suY29tL3NoYXJlci5waHA/cz0xMDBcIjtcclxuICAgIHVybCArPSBcIiZwW3RpdGxlXT1cIiArIGVuY29kZVVSSUNvbXBvbmVudChwdGl0bGUpO1xyXG4gICAgdXJsICs9IFwiJnBbc3VtbWFyeV09XCIgKyBlbmNvZGVVUklDb21wb25lbnQodGV4dCk7XHJcbiAgICB1cmwgKz0gXCImcFt1cmxdPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KHB1cmwpO1xyXG4gICAgdXJsICs9IFwiJnBbaW1hZ2VzXVswXT1cIiArIGVuY29kZVVSSUNvbXBvbmVudChwaW1nKTtcclxuICAgIFNoYXJlLnBvcHVwKHVybCk7XHJcbiAgfSxcclxuICB0d2l0dGVyOiBmdW5jdGlvbiAocHVybCwgcHRpdGxlKSB7XHJcbiAgICB1cmwgPSBcImh0dHA6Ly90d2l0dGVyLmNvbS9zaGFyZT9cIjtcclxuICAgIHVybCArPSBcInRleHQ9XCIgKyBlbmNvZGVVUklDb21wb25lbnQocHRpdGxlKTtcclxuICAgIHVybCArPSBcIiZ1cmw9XCIgKyBlbmNvZGVVUklDb21wb25lbnQocHVybCk7XHJcbiAgICB1cmwgKz0gXCImY291bnR1cmw9XCIgKyBlbmNvZGVVUklDb21wb25lbnQocHVybCk7XHJcbiAgICBTaGFyZS5wb3B1cCh1cmwpO1xyXG4gIH0sXHJcblxyXG4gIHBvcHVwOiBmdW5jdGlvbiAodXJsKSB7XHJcbiAgICB3aW5kb3cub3Blbih1cmwsIFwiXCIsIFwidG9vbGJhcj0wLHN0YXR1cz0wLHdpZHRoPTYyNixoZWlnaHQ9NDM2XCIpO1xyXG4gIH0sXHJcbn07XHJcbiIsImNvbnN0IHByb2R1Y3RCdG5zID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnByb2R1Y3QtdGFic19fYnRuXCIpKTtcclxuY29uc3QgcHJvZHVjdFRhYnMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucHJvZHVjdC1kZXNjcl9faXRlbVwiKSk7XHJcbmNvbnN0IHByb2R1Y3RSZXZpZXcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJhdGluZ19fbGlua1wiKTtcclxuXHJcbmZ1bmN0aW9uIHJldmlld0NsaWNrKHByb2R1Y3RUYWJzLCBwcm9kdWN0QnRucykge1xyXG4gIHByb2R1Y3RUYWJzLm1hcCgodGFiKSA9PiB7XHJcbiAgICB0YWIuY2xhc3NMaXN0LnJlbW92ZShcInByb2R1Y3QtZGVzY3JfX2l0ZW1fYWN0aXZlXCIpO1xyXG4gICAgaWYgKHRhYi5pZCA9PT0gXCJyZXZpZXdcIikge1xyXG4gICAgICB0YWIuY2xhc3NMaXN0LmFkZChcInByb2R1Y3QtZGVzY3JfX2l0ZW1fYWN0aXZlXCIpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIHByb2R1Y3RCdG5zLm1hcCgoYnRuKSA9PiB7XHJcbiAgICBidG4uY2xhc3NMaXN0LnJlbW92ZShcInByb2R1Y3QtdGFic19fYnRuX2FjdGl2ZVwiKTtcclxuICAgIGlmIChidG4uZGF0YXNldC50YWIgPT09IFwicmV2aWV3XCIpIHtcclxuICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoXCJwcm9kdWN0LXRhYnNfX2J0bl9hY3RpdmVcIik7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbmlmIChwcm9kdWN0UmV2aWV3KSB7XHJcbiAgcHJvZHVjdFJldmlldy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgcmV2aWV3Q2xpY2socHJvZHVjdFRhYnMsIHByb2R1Y3RCdG5zKTtcclxuICB9KTtcclxufVxyXG5cclxucHJvZHVjdEJ0bnMubWFwKChidG4pID0+IHtcclxuICBidG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgIHByb2R1Y3RUYWJzLm1hcCgodGFiKSA9PiB7XHJcbiAgICAgIHRhYi5jbGFzc0xpc3QucmVtb3ZlKFwicHJvZHVjdC1kZXNjcl9faXRlbV9hY3RpdmVcIik7XHJcbiAgICAgIGlmIChidG4uZGF0YXNldC50YWIgPT09IHRhYi5pZCkge1xyXG4gICAgICAgIHRhYi5jbGFzc0xpc3QuYWRkKFwicHJvZHVjdC1kZXNjcl9faXRlbV9hY3RpdmVcIik7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcHJvZHVjdEJ0bnMubWFwKChidG4pID0+IHtcclxuICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoXCJwcm9kdWN0LXRhYnNfX2J0bl9hY3RpdmVcIik7XHJcbiAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcInByb2R1Y3QtdGFic19fYnRuX2FjdGl2ZVwiKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuXHJcbmNvbnN0IGFjY0J0bnMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYWNjb3VudC10YWJzX19idG5cIikpO1xyXG5jb25zdCBhY2NUYWJzID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmFjY291bnQtaXRlbVwiKSk7XHJcblxyXG5hY2NCdG5zLm1hcCgoYnRuKSA9PiB7XHJcbiAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBhY2NUYWJzLm1hcCgodGFiKSA9PiB7XHJcbiAgICAgIHRhYi5jbGFzc0xpc3QuYWRkKFwiYWNjb3VudC1pdGVtX2hpZGRlblwiKTtcclxuICAgICAgaWYgKGJ0bi5kYXRhc2V0LnRhYiA9PT0gdGFiLmlkKSB7XHJcbiAgICAgICAgdGFiLmNsYXNzTGlzdC5yZW1vdmUoXCJhY2NvdW50LWl0ZW1faGlkZGVuXCIpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIGFjY0J0bnMubWFwKChidG4pID0+IHtcclxuICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoXCJhY2NvdW50LXRhYnNfX2J0bl9hY3RpdmVcIik7XHJcbiAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFjY291bnQtdGFic19fYnRuX2FjdGl2ZVwiKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuIl19
